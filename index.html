<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Visualiseur Audio â€“ 20 modes</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
*,*:before,*:after{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;background:#0d0d0d;font-family:'Poppins',sans-serif;overflow:hidden;color:#f3f3f3}
canvas{position:absolute;inset:0;width:100%;height:100%}
body.idle{cursor:none}
#startBtn{
  position:absolute;inset:0;margin:auto;padding:1.1rem 2.4rem;
  font-size:1.3rem;font-weight:600;border:none;border-radius:50px;
  background:linear-gradient(135deg,#29d8ff,#8f00ff);color:#fff;
  box-shadow:0 4px 30px #0006;cursor:pointer;transition:transform .4s,opacity 4s;
  width:190px;height:64px;z-index:30
}
#startBtn:hover{transform:scale(1.05)}
#startBtn.fade{opacity:0;pointer-events:none}
#controls{
  position:fixed;left:50%;bottom:20px;transform:translateX(-50%);
  display:flex;align-items:center;gap:1rem;padding:.8rem 1.2rem;
  backdrop-filter:blur(14px)saturate(180%);background:#ffffff0d;
  border:1px solid #ffffff26;border-radius:14px;box-shadow:0 8px 32px #0006;
  transition:opacity 1s ease 3s;z-index:20
}
#controls.hide{opacity:0;pointer-events:none}
#controls:hover{opacity:1 !important;transition:opacity .3s}
select,input[type=color],input[type=range],button.tool{
  background:#1b1b1b;border:1px solid #444;border-radius:8px;
  color:#f3f3f3;padding:.4rem .6rem;font-size:.9rem;cursor:pointer
}
label{display:flex;align-items:center;gap:.4rem;font-size:.85rem}
input[type=range]{width:120px}
input[type=color]{padding:0;border:none;width:38px;height:38px}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:14px;height:14px;border-radius:50%;background:#29d8ff;border:2px solid #fff;cursor:ew-resize}
input[type=range]::-moz-range-thumb{width:14px;height:14px;border-radius:50%;background:#29d8ff;border:none;cursor:ew-resize}
@media(max-width:680px){#controls{flex-direction:column;gap:.6rem}}
</style>
</head>
<body>
<canvas id="canvas"></canvas>
<button id="startBtn">ðŸŽ§ DÃ©marrer</button>
<div id="controls" class="hide">
  <label><select id="visSelect"></select></label>
  <label>Couleur<input type="color" id="color"></label>
  <label>Taille<input type="range" id="size" min="2" max="40" value="8"></label>
  <label>DensitÃ©<input type="range" id="density" min="32" max="512" step="16" value="128"></label>
  <button id="fsBtn" class="tool">â›¶ Plein Ã©cran</button>
</div>
<script>
const cvs=document.getElementById('canvas'),ctx=cvs.getContext('2d'),
      startBtn=document.getElementById('startBtn'),controls=document.getElementById('controls'),
      visSel=document.getElementById('visSelect'),colorPicker=document.getElementById('color'),
      sizeRange=document.getElementById('size'),densityRange=document.getElementById('density'),
      fsBtn=document.getElementById('fsBtn');
let W=innerWidth,H=innerHeight;const resize=()=>{W=cvs.width=innerWidth;H=cvs.height=innerHeight};addEventListener('resize',resize);resize();
let aCtx,analyser,data;
const cfg={color:'#29d8ff',size:8,density:128,mode:0};
colorPicker.value=cfg.color;colorPicker.oninput=e=>cfg.color=e.target.value;
sizeRange.oninput=e=>cfg.size=+e.target.value;
densityRange.oninput=e=>cfg.density=+e.target.value;
visSel.onchange=e=>cfg.mode=+e.target.value;
const modes=[];
const add=(n,f)=>{modes.push(f);visSel.add(new Option(n,modes.length-1))};

// 1 Barres
add('Barres',d=>{
  const bw=W/cfg.density;
  ctx.fillStyle=cfg.color;
  for(let i=0;i<cfg.density;i++){
    const val=d[i]/255,h=val*H;
    ctx.fillRect(i*bw,H-h,bw*0.9,h);
  }
});

// 2 Barres miroir
add('Barres miroir',d=>{
  const bw=W/cfg.density;
  ctx.fillStyle=cfg.color;
  for(let i=0;i<cfg.density;i++){
    const v=d[i]/255,h=v*H/2;
    ctx.fillRect(i*bw,H/2-h,bw*0.85,h);
    ctx.fillRect(i*bw,H/2,bw*0.85,h);
  }
});

// 3 Cercles radiaux
add('Cercle radial',d=>{
  const rBase=Math.min(W,H)/4,cx=W/2,cy=H/2;
  ctx.lineWidth=cfg.size;ctx.strokeStyle=cfg.color;ctx.beginPath();
  for(let i=0;i<cfg.density;i++){
    const v=d[i]/255,ang=i/cfg.density*2*Math.PI;
    const r=rBase+v*120;
    ctx.lineTo(cx+Math.cos(ang)*r,cy+Math.sin(ang)*r);
  }
  ctx.closePath();ctx.stroke();
});

// 4 Rond de points
add('Anneau de points',d=>{
  const cx=W/2,cy=H/2,base=Math.min(W,H)/5;
  ctx.fillStyle=cfg.color;
  for(let i=0;i<cfg.density;i++){
    const v=d[i]/255,ang=i/cfg.density*2*Math.PI,r=base+v*100;
    ctx.beginPath();ctx.arc(cx+Math.cos(ang)*r,cy+Math.sin(ang)*r,cfg.size*v+2,0,6.283);ctx.fill();
  }
});

// 5 Vague horizontale
add('Vague',d=>{
  ctx.lineWidth=cfg.size;ctx.strokeStyle=cfg.color;ctx.beginPath();
  for(let i=0;i<cfg.density;i++){
    const x=i/cfg.density*W,y=H/2+(d[i]-128)*1.5;
    if(i)ctx.lineTo(x,y);else ctx.moveTo(x,y);
  }
  ctx.stroke();
});

// 6 LED matrix
add('LED Matrix',d=>{
  const cols=Math.sqrt(cfg.density)|0,size=Math.min(W,H)/cols;
  for(let i=0;i<cfg.density;i++){
    const v=d[i]/255, x=(i%cols)*size, y=(i/cols|0)*size;
    ctx.fillStyle=`${cfg.color}${(v*255|0).toString(16).padStart(2,'0')}`;
    ctx.fillRect(x,y,size-1,size-1);
  }
});

// 7 Rayons
add('Rayons',d=>{
  const cx=W/2,cy=H/2,base=20;
  ctx.lineWidth=cfg.size*.5;ctx.strokeStyle=cfg.color;
  for(let i=0;i<cfg.density;i++){
    const v=d[i]/255,ang=i/cfg.density*2*Math.PI;
    const r=base+v*(Math.min(W,H)/2);
    ctx.beginPath();ctx.moveTo(cx,cy);
    ctx.lineTo(cx+Math.cos(ang)*r,cy+Math.sin(ang)*r);
    ctx.stroke();
  }
});

// 8 Electrocardiogramme
add('Ã‰lectrocardiogramme',d=>{
  ctx.lineWidth=cfg.size;ctx.strokeStyle=cfg.color;ctx.beginPath();
  for(let i=0;i<cfg.density;i++){
    const x=i/cfg.density*W,y=H/2-(d[i]-128)*2.5;
    i?ctx.lineTo(x,y):ctx.moveTo(x,y);
  }
  ctx.stroke();
});

// 9 Spirale
add('Spirale',d=>{
  const cx=W/2,cy=H/2,maxR=Math.min(W,H)/2;
  ctx.lineWidth=cfg.size*.6;ctx.strokeStyle=cfg.color;ctx.beginPath();
  for(let i=0;i<cfg.density;i++){
    const t=i/cfg.density*8*Math.PI;
    const r=d[i]/255*maxR;
    ctx.lineTo(cx+Math.cos(t)*r,cy+Math.sin(t)*r);
  }
  ctx.stroke();
});

// 10 Blob liquide
add('Blob',d=>{
  ctx.fillStyle=`${cfg.color}55`;
  const cx=W/2,cy=H/2,base=60;
  for(let i=0;i<cfg.density;i++){
    const v=d[i]/255,ang=i/cfg.density*2*Math.PI;
    const r=base+v*150;
    ctx.beginPath();ctx.arc(cx+Math.cos(ang)*r,cy+Math.sin(ang)*r,cfg.size*1.5,0,6.283);
    ctx.fill();
  }
});

// 11 Anneaux
add('Anneaux',d=>{
  const cx=W/2,cy=H/2;
  for(let i=0;i<cfg.density/2;i++){
    const v=d[i]/255,r=i*cfg.size*1.2+v*40;
    ctx.lineWidth=cfg.size*.4;ctx.strokeStyle=cfg.color;
    ctx.beginPath();ctx.arc(cx,cy,r,0,6.283);ctx.stroke();
  }
});

// 12 Points orbitaux
add('Orbite',d=>{
  const cx=W/2,cy=H/2;
  ctx.fillStyle=cfg.color;
  for(let i=0;i<cfg.density;i++){
    const v=d[i]/255,ang=performance.now()/600+i,r=v*H/2;
    ctx.fillRect(cx+Math.cos(ang)*r,cy+Math.sin(ang)*r,cfg.size,cfg.size);
  }
});

// 13 Montagnes
add('Montagnes',d=>{
  ctx.fillStyle='#000d';ctx.fillRect(0,0,W,H);
  ctx.fillStyle=cfg.color;
  const step=W/(cfg.density/4);
  for(let i=0;i<cfg.density;i+=4){
    const v=d[i]/255,x=i/cfg.density*W,h=v*H/2;
    ctx.beginPath();ctx.moveTo(x,H);ctx.lineTo(x+step/2,H-h);
    ctx.lineTo(x+step,H);ctx.closePath();ctx.fill();
  }
});

// 14 Eventails
add('Eventails',d=>{
  const cx=W/2,cy=H,r=W/2,sl=Math.PI/cfg.density;
  ctx.fillStyle=cfg.color;
  for(let i=0;i<cfg.density;i++){
    const v=d[i]/255;
    ctx.beginPath();ctx.moveTo(cx,cy);
    ctx.arc(cx,cy,r*v,i*sl,-i*sl,true);
    ctx.closePath();ctx.fill();
  }
});

// 15 Particules
add('Particules',d=>{
  ctx.fillStyle='#0002';ctx.fillRect(0,0,W,H);
  ctx.fillStyle=cfg.color;
  for(let i=0;i<cfg.density;i++){
    const v=d[i]/255,ang=Math.random()*6.283,r=v*H/2;
    ctx.fillRect(W/2+Math.cos(ang)*r,H/2+Math.sin(ang)*r,cfg.size,cfg.size);
  }
});

// 16 Splash pixels
add('Splash pixel',d=>{
  const img=ctx.createImageData(W,H);const c=parseInt(cfg.color.slice(1),16);
  const r=(c>>16)&255,g=(c>>8)&255,b=c&255;
  for(let i=0;i<img.data.length;i+=4){
    const val=d[(i/4)%cfg.density]/255;
    img.data[i]=r*val;img.data[i+1]=g*val;img.data[i+2]=b*val;img.data[i+3]=255*val;
  }
  ctx.putImageData(img,0,0);
});

// 17 Piliers
add('Piliers',d=>{
  const cols=Math.cbrt(cfg.density)|0,size=W/cols;
  ctx.fillStyle=cfg.color;
  for(let i=0;i<cfg.density;i++){
    const v=d[i]/255,x=(i%cols)*size,y=(i/cols|0)*size,h=v*H/2;
    ctx.fillRect(x,y+h,size-2,H-h);
  }
});

// 18 Polygone
add('Polygone',d=>{
  const cx=W/2,cy=H/2,base=Math.min(W,H)/4;
  ctx.fillStyle=cfg.color;ctx.beginPath();
  for(let i=0;i<cfg.density;i++){
    const v=d[i]/255,ang=i/cfg.density*6.283,r=base+v*120;
    i?ctx.lineTo(cx+Math.cos(ang)*r,cy+Math.sin(ang)*r):ctx.moveTo(cx+Math.cos(ang)*r,cy+Math.sin(ang)*r);
  }
  ctx.closePath();ctx.fill();
});

// 19 Ligne nÃ©on
add('Ligne nÃ©on',d=>{
  ctx.shadowBlur=20;ctx.shadowColor=cfg.color;
  ctx.lineWidth=cfg.size;ctx.strokeStyle=cfg.color;ctx.beginPath();
  for(let i=0;i<cfg.density;i++){
    const x=i/cfg.density*W,y=H/2+(d[i]-128)*1.8;
    i?ctx.lineTo(x,y):ctx.moveTo(x,y);
  }
  ctx.stroke();ctx.shadowBlur=0;
});

// 20 Barres dÃ©gradÃ©es
add('Barres dÃ©gradÃ©es',d=>{
  const bw=W/cfg.density;
  const grad=ctx.createLinearGradient(0,0,0,H);
  grad.addColorStop(0,cfg.color);
  grad.addColorStop(1,'#000');
  ctx.fillStyle=grad;
  for(let i=0;i<cfg.density;i++){
    const h=d[i]/255*H;
    ctx.fillRect(i*bw,H-h,bw*.9,h);
  }
});

function draw(){
  requestAnimationFrame(draw);
  if(!analyser)return;
  analyser.getByteFrequencyData(data);
  ctx.fillStyle='rgba(0,0,0,.07)';ctx.fillRect(0,0,W,H);
  modes[cfg.mode](data);
}
startBtn.onclick=async()=>{
  try{
    const stream=await navigator.mediaDevices.getUserMedia({audio:true});
    aCtx=new (AudioContext||webkitAudioContext)();
    analyser=aCtx.createAnalyser();analyser.fftSize=1024;
    data=new Uint8Array(analyser.frequencyBinCount);
    aCtx.createMediaStreamSource(stream).connect(analyser);

    startBtn.classList.add('fade');
    controls.classList.remove('hide');setTimeout(()=>controls.classList.add('hide'),3000);
    draw();
  }catch{alert('Micro refusÃ©');}
};
// Curseur auto-hide aprÃ¨s inactivitÃ©
let idleTimer;const idleDelay=2500;
const resetIdle=()=>{clearTimeout(idleTimer);document.body.classList.remove('idle');idleTimer=setTimeout(()=>document.body.classList.add('idle'),idleDelay);};
addEventListener('mousemove',resetIdle);resetIdle();
// Controls show/auto-hide
let hideT;
addEventListener('mousemove',e=>{
  const rect=controls.getBoundingClientRect(),near=Math.abs(e.clientY-rect.top)<80;
  if(near){controls.classList.remove('hide');clearTimeout(hideT);}
  else if(!controls.classList.contains('hide')){clearTimeout(hideT);hideT=setTimeout(()=>controls.classList.add('hide'),800);}
});
// Plein Ã©cran
fsBtn.onclick=()=>{
  const el=document.documentElement;
  if(!document.fullscreenElement){el.requestFullscreen?.()||el.webkitRequestFullscreen?.();}
  else{document.exitFullscreen?.()||document.webkitExitFullscreen?.();}
};
</script>
</body>
</html>
