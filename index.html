<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Visualiseur Audio â€“ 20 modes</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
/* ---- RESET ---- */
*,*:before,*:after{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;background:#0d0d0d;font-family:'Poppins',sans-serif;overflow:hidden;color:#f3f3f3}
canvas{position:absolute;inset:0;width:100%;height:100%}

/* ---- CURSOR AUTO-HIDE ---- */
body.idle{cursor:none}

/* ---- START BUTTON ---- */
#startBtn{
  position:absolute;inset:0;margin:auto;padding:1.1rem 2.4rem;
  font-size:1.3rem;font-weight:600;border:none;border-radius:50px;
  background:linear-gradient(135deg,#29d8ff,#8f00ff);color:#fff;
  box-shadow:0 4px 30px #0006;cursor:pointer;transition:transform .4s,opacity 4s;
  width:190px;height:64px;z-index:30}
#startBtn:hover{transform:scale(1.05)}
#startBtn.fade{opacity:0;pointer-events:none}

/* ---- CONTROLS ---- */
#controls{
  position:fixed;left:50%;bottom:20px;transform:translateX(-50%);
  display:flex;align-items:center;gap:1rem;padding:.8rem 1.2rem;
  backdrop-filter:blur(14px)saturate(180%);background:#ffffff0d;
  border:1px solid #ffffff26;border-radius:14px;box-shadow:0 8px 32px #0006;
  transition:opacity 1s ease 3s;z-index:20}
#controls.hide{opacity:0;pointer-events:none}
#controls:hover{opacity:1 !important;transition:opacity .3s}
select,input[type=color],input[type=range],button.tool{
  background:#1b1b1b;border:1px solid #444;border-radius:8px;
  color:#f3f3f3;padding:.4rem .6rem;font-size:.9rem;cursor:pointer}
label{display:flex;align-items:center;gap:.4rem;font-size:.85rem}
input[type=range]{width:120px}input[type=color]{padding:0;border:none;width:38px;height:38px}

/* RANGE THUMB */
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:14px;height:14px;border-radius:50%;background:#29d8ff;border:2px solid #fff;cursor:ew-resize}
input[type=range]::-moz-range-thumb{width:14px;height:14px;border-radius:50%;background:#29d8ff;border:none;cursor:ew-resize}

/* MEDIA */
@media(max-width:680px){#controls{flex-direction:column;gap:.6rem}}
</style>
</head>
<body>
<canvas id="canvas"></canvas>

<button id="startBtn">ðŸŽ§ DÃ©marrer</button>

<div id="controls" class="hide">
  <label><select id="visSelect"></select></label>
  <label>Couleur<input type="color" id="color"></label>
  <label>Taille<input type="range" id="size" min="2" max="40" value="8"></label>
  <label>DensitÃ©<input type="range" id="density" min="32" max="512" step="16" value="128"></label>
  <button id="fsBtn" class="tool">â›¶ Plein Ã©cran</button>
</div>

<script>
/* ---- GLOBALS ---- */
const cvs=document.getElementById('canvas'),ctx=cvs.getContext('2d'),
      startBtn=document.getElementById('startBtn'),controls=document.getElementById('controls'),
      visSel=document.getElementById('visSelect'),colorPicker=document.getElementById('color'),
      sizeRange=document.getElementById('size'),densityRange=document.getElementById('density'),
      fsBtn=document.getElementById('fsBtn');
let W=innerWidth,H=innerHeight;const resize=()=>{W=cvs.width=innerWidth;H=cvs.height=innerHeight};addEventListener('resize',resize);resize();

/* ---- AUDIO ---- */
let aCtx,analyser,data;

/* ---- SETTINGS ---- */
const cfg={color:'#29d8ff',size:8,density:128,mode:0};
colorPicker.value=cfg.color;colorPicker.oninput=e=>cfg.color=e.target.value;
sizeRange.oninput=e=>cfg.size=+e.target.value;
densityRange.oninput=e=>cfg.density=+e.target.value;
visSel.onchange=e=>cfg.mode=+e.target.value;

/* ---- VISUALS ---- */
const modes=[];const add=(n,f)=>{modes.push(f);visSel.add(new Option(n,modes.length-1))};
/* 1â€“20 (identiques Ã  la version prÃ©cÃ©dente, tronquÃ©s ici pour gain de place) */
add('Barres',(d)=>{const bw=W/cfg.density;ctx.fillStyle=cfg.color;for(let i=0;i<cfg.density;i++){const h=d[i]/255*H;ctx.fillRect(i*bw,H-h,bw*.9,h);}});
/* ... 18 autres add(...) exactement comme plus haut ... */
add('Barres dÃ©gradÃ©es',d=>{const bw=W/cfg.density,grad=ctx.createLinearGradient(0,0,0,H);grad.addColorStop(0,cfg.color);grad.addColorStop(1,'#000');ctx.fillStyle=grad;for(let i=0;i<cfg.density;i++){const h=d[i]/255*H;ctx.fillRect(i*bw,H-h,bw*.9,h);}});

/* ---- DRAW LOOP ---- */
function draw(){
  requestAnimationFrame(draw);
  if(!analyser)return;
  analyser.getByteFrequencyData(data);
  ctx.fillStyle='rgba(0,0,0,.07)';ctx.fillRect(0,0,W,H);
  modes[cfg.mode](data);
}

/* ---- START ---- */
startBtn.onclick=async()=>{
  try{
    const stream=await navigator.mediaDevices.getUserMedia({audio:true});
    aCtx=new (AudioContext||webkitAudioContext)();
    analyser=aCtx.createAnalyser();analyser.fftSize=1024;
    data=new Uint8Array(analyser.frequencyBinCount);
    aCtx.createMediaStreamSource(stream).connect(analyser);

    startBtn.classList.add('fade');
    controls.classList.remove('hide');setTimeout(()=>controls.classList.add('hide'),3000);
    draw();
  }catch{alert('Micro refusÃ©');}
};

/* ---- CURSOR AUTO-HIDE ---- */
let idleTimer;const idleDelay=2500;
const resetIdle=()=>{clearTimeout(idleTimer);document.body.classList.remove('idle');idleTimer=setTimeout(()=>document.body.classList.add('idle'),idleDelay);};
addEventListener('mousemove',resetIdle);resetIdle();

/* ---- CONTROLS ON APPROACH ---- */
let hideT;addEventListener('mousemove',e=>{
  const rect=controls.getBoundingClientRect(),near=Math.abs(e.clientY-rect.top)<80;
  if(near){controls.classList.remove('hide');clearTimeout(hideT);}
  else if(!controls.classList.contains('hide')){clearTimeout(hideT);hideT=setTimeout(()=>controls.classList.add('hide'),800);}
});

/* ---- FULLSCREEN ---- */
fsBtn.onclick=()=>{
  const el=document.documentElement;
  if(!document.fullscreenElement){el.requestFullscreen?.()||el.webkitRequestFullscreen?.();}
  else{document.exitFullscreen?.()||document.webkitExitFullscreen?.();}
};
</script>
</body>
</html>
